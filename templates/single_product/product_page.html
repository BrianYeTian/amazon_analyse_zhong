<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Gramos - Admin Dashboard</title>

    <!-- begin::global styles -->
    <link rel="stylesheet" href="../../static/assets/vendors/bundle.css" type="text/css">
    <!-- end::global styles -->

    <!-- begin::dataTable -->
    <link rel="stylesheet" href="../../static/assets/vendors/dataTable/responsive.bootstrap.min.css" type="text/css">
    <!-- end::dataTable -->

    <!-- begin::select2 -->
    <link rel="stylesheet" href="../../static/assets/vendors/select2/css/select2.min.css" type="text/css">
    <!-- end::select2 -->

    <!-- begin::datepicker -->
    <link rel="stylesheet" href="../../static/assets/vendors/datepicker/daterangepicker.css">
    <!-- begin::datepicker -->

    <!-- begin::vmap -->
    <link rel="stylesheet" href="../../static/assets/vendors/vmap/jqvmap.min.css">
    <!-- begin::vmap -->

    <!-- begin::range slider -->
    <link rel="stylesheet" href="../../static/assets/vendors/range-slider/css/ion.rangeSlider.min.css" type="text/css">
    <!-- end::range slider -->

    <!-- begin::tagsinput -->
    <link rel="stylesheet" href="../../static/assets/vendors/tagsinput/bootstrap-tagsinput.css" type="text/css">
    <!-- end::tagsinput -->

    <!-- begin::custom styles -->
    <link rel="stylesheet" href="../../static/assets/css/app.css" type="text/css">
    <link rel="stylesheet" href="../../static/assets/css/custom.css" type="text/css">
    <!-- end::custom styles -->

</head>
<body>
<!-- begin::page loader-->
<div class="page-loader">
    <div class="spinner-border"></div>
    <span>Loading ...</span>
</div>


<!-- end::sidebar -->

<!-- begin::side menu -->
<div class="side-menu">
    <div class='side-menu-body'>
        <ul>
            <li class="side-menu-divider">Navigation</li>
            <li>
                <a href="#"><i class="icon ti-home"></i> <span>首 页</span> </a>
                <ul>
                    <li><a href="{{ url_for('user_bp.index') }}">任务预览</a></li>
                    {#                    <li><a href="dashboard-two.html">Website Statistics</a></li>#}
                    {#                    <li><a href="dashboard-three.html">Alternative</a></li>#}
                </ul>
            </li>
            {#            <li><a href="widgets.html"><i class="icon ti-paint-bucket"></i> <span>Widgets</span> <span#}
            {#                    class="badge bg-danger-gradient">8+</span> </a></li>#}
            <li>
                <a data-attr="layout-builder-toggle" href="#">
                    <i class="icon ti-layout"></i>
                    <span>搜索排名监控</span>
                </a>
                <ul>
                    <li>
                        <a href="#">Menu</a>
                        <ul>
                            <li><a href="layout-horizontal-menu.html">Horizontal</a></li>
                            <li><a href="layout-icon-menu.html">Icon</a></li>
                            <li><a href="layout-dark-menu.html">Dark</a></li>
                            <li><a href="layout-hidden-menu.html">Hidden</a></li>
                        </ul>
                    </li>
                    <li><a href="layout-container.html">Container</a></li>
                    <li><a href="layout-dark.html">Dark</a></li>
                    <li>
                        <a href="#">Other</a>
                        <ul>
                            <li><a href="layout-1.html">Layout 1</a></li>
                            <li><a href="layout-2.html">Layout 2</a></li>
                            <li><a href="layout-3.html">Layout 3</a></li>
                            <li><a href="layout-4.html">Layout 4</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li><a href="#"><i class="icon ti-rocket"></i> <span>类 目</span> </a>
                <ul>
                    <li><a href="chat.html">Chat </a></li>
                    <li><a href="#">Email </a>
                        <ul>
                            <li><a href="inbox.html">Inbox </a></li>
                            <li><a href="read-email.html">Email Read </a></li>
                            <li><a href="compose-email.html">Compose </a></li>
                        </ul>
                    </li>
                    <li><a href="#">Calendar </a>
                        <ul>
                            <li><a href="calendar-basic.html">Basic Calendar </a></li>
                            <li><a href="external-dragging.html">External Dragging </a></li>
                            <li><a href="calendar-list.html">Calendar List </a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li><a href="#"><i class="icon ti-layers-alt"></i> <span>关键词查询</span> </a>
                <ul>
                    <li><a href="alerts.html">关键词查ASIN </a></li>
                    <li><a href="badge.html">ASIN反查关键词 </a></li>
{#                    <li><a href="buttons.html">Buttons </a></li>#}
{#                    <li><a href="pagination.html">Pagination </a></li>#}
{#                    <li><a href="dropdown.html">Dropdown </a></li>#}
{#                    <li><a href="accordion.html">Accordion </a></li>#}
{#                    <li><a href="colors.html">Colors </a></li>#}
{#                    <li><a href="carousel.html">Carousel </a></li>#}
{#                    <li><a href="tables.html">Tables </a>#}
                </ul>
            </li>
            <li class="open"><a href="#"><i class="icon ti-paint-roller"></i> <span>单品数据</span> </a>
                <ul>
                    <li><a href="{{ url_for('sp_bp.add') }}" style=''> 添加产品</a></li>
                    <li><a class="active" href="{{ url_for('sp_bp.dp') }}"> 销量跟踪</a></li>
                    <li><a href="toast.html">销量查询 </a></li>
                    <li><a href="{{ url_for('sp_bp.get_cart') }}">监控购物车 </a></li>
                    <li><a href="tour.html">评价抓取 </a></li>
                    <li><a href="swiper.html">评价分析 </a></li>
                    <li><a href="tree-view.html">搜索排名监控 </a></li>
                    <li><a href="tree-view.html">搜索排名查看 </a></li>
                </ul>
            </li>
            <li><a href="#"><i class="icon ti-clipboard"></i> <span>广告分析</span> </a>
                <ul>
                    <li><a href="basic-form.html">Basic Form </a></li>
                    <li><a href="custom-form.html">Custom Form </a></li>
                    <li><a href="advanced-form.html">Advanced Form </a></li>
                    <li><a href="datepicker.html">Datepicker </a></li>
                    <li><a href="timepicker.html">Timepicker </a></li>
                    <li><a href="colorpicker.html">Colorpicker </a></li>
                    <li><a href="form-validation.html">Form Validation </a></li>
                    <li><a href="form-wizard.html">Form Wizard </a></li>
                    <li><a href="file-upload.html">File Upload </a></li>
                    <li><a href="#">CKEditor </a>
                        <ul>
                            <li><a href="ckeditor-article.html">Article Editor </a></li>
                            <li><a href="ckeditor-inline.html">Inline Editor </a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            {#            <li><a href="icons.html"><i class="icon ti-crown"></i> <span>广告分析</span> </a></li>#}
            <li>
                <a href="#">
                    <i class="icon ti-map"></i>
                    <span>产品关联购买</span>
                </a>
                <ul>
                    <li><a href="google-map.html">Google</a></li>
                    <li><a href="vector-map.html">Vector</a></li>
                </ul>
            </li>
            <li>
                <a href="#">
                    <i class="icon ti-pie-chart"></i>
                    <span>关于作者</span>
                </a>
                <ul>
                    <li><a href="chart-chartjs.html">Chartjs</a></li>
                    <li><a href="chart-justgage.html">Justgage</a></li>
                    <li><a href="chart-peity.html">Peity</a></li>
                </ul>
            </li>
            <li><a href="#"><i class="icon ti-face-smile"></i> <span>投诉与建议</span> </a>
                <ul>
                    <li><a href="login.html">投诉 </a></li>
                    <li><a href="register.html">建议 </a></li>
                </ul>
            </li>
        </ul>
    </div>
</div>
<!-- end::side menu -->

<!-- begin::navbar -->
<nav class="navbar">
    <div class="container-fluid">

        <div class="header-logo">
            <a href="#">
                <img src="../../static/assets/media/image/light-logo.png" alt="...">
                <span class="logo-text d-none d-lg-block">一个神奇的网站</span>
            </a>
        </div>

        <div class="header-body">
            <ul class="navbar-nav">
                <li class="nav-item dropdown d-none d-lg-block">
                    <a href="#" class="nav-link" data-toggle="dropdown">
                        <i class="fa fa-th-large"></i>
                    </a>
                </li>
            </ul>
            <form class="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search ..."
                           aria-label="Recipient's username"
                           aria-describedby="button-addon2">
                    <div class="input-group-append">
                        <button class="btn" type="button" id="button-addon2">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="#" class="d-lg-none d-sm-block nav-link search-panel-open">
                        <i class="fa fa-search"></i>
                    </a>
                </li>
                <li class="nav-item" style="margin-top: 5px;margin-right: 20px">
                    <h2 class="text-uppercase font-size-12 m-b-0" style="color: whitesmoke">Messages</h2>
                    <!--需要换成用户名-->
                    <small class="font-size-16">welcome!</small>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" data-toggle="dropdown">
                        <figure class="avatar avatar-sm avatar-state-success">
                            <img class="rounded-circle" src="../../static/assets/media/image/avatar.jpg" alt="...">
                        </figure>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <!--                        <a href="profile.html" class="dropdown-item">Profile</a>-->
                        <!--                        <a href="#" data-sidebar-target="#settings" class="sidebar-open dropdown-item">Settings</a>-->
                        <div class="dropdown-divider"></div>
                        <a href="{{ url_for('user_bp.logout') }}" class="text-danger dropdown-item">Logout</a>
                    </div>
                </li>
                <li class="nav-item d-lg-none d-sm-block">
                    <a href="#" class="nav-link side-menu-open">
                        <i class="ti-menu"></i>
                    </a>
                </li>
            </ul>
        </div>

    </div>
</nav>
<!-- end::navbar -->


<main class="main-content">

    <div class="container-fluid">

        <!-- begin::page header -->
        <div class="page-header d-md-flex justify-content-between align-items-center">
            <h4>销量跟踪</h4>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb m-t-0">
                    <li class="breadcrumb-item"><a href="#">单品数据</a></li>
{#                    <li class="breadcrumb-item"><a href="#">UI Elements</a></li>#}
{#                    <li class="breadcrumb-item"><a href="#">Tables</a></li>#}
                    <li class="breadcrumb-item active" aria-current="page">销量跟踪</li>
                </ol>
            </nav>
        </div>
        <!-- end::page header -->




        <div class="card">
            <div class="card-body">
{#                            <h5 class="card-title">Select2</h5>#}
                <div class="form-group" style="">
                    <input type="button" class="btn btn-outline-danger" value="一键删除" id="deleteLimit">
                </div>
                <br>


{#                <p>标 签</p>#}
{#                <div class="form-group" style="width: 400px">#}
{#                    <select class="js-example-basic-single" id="tag_select">#}
{##}
{#                    </select>#}
{#                </div>#}

                <div class="form-group" style="">
                    <input type="button" class="btn btn-outline-warning" value="反  选" id="btnCheckedRev"/>
                    <input type="button" class="btn btn-outline-warning" value="批量爬取" id="btnSubmit"/>
                </div>

{#                <p style="float: left">市 场</p>#}
{#                <div class="form-group btn-block" style="width: 400px">#}
{#                    <select class="js-example-basic-single" multiple id="mkp_select">#}
{#                        <option></option>#}
{#                        <option value="de">de</option>#}
{#                        <option value="us">us</option>#}
{#                        <option value="uk">uk</option>#}
{#                        <option value="fr">fr</option>#}
{#                        <option value="it">it</option>#}
{#                        <option value="es">es</option>#}
{#                        <option value="jp">jp</option>#}
{#                    </select>#}
{#                </div>#}

            </div>
        </div>


        <div class="card">
            <div class="card-body">
                <table id="example1" class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th style="text-align: center"><input type="checkbox" id="checkAll"></th>
                        <th style="text-align: center">ASIN</th>
                        <th style="text-align: center">市场</th>
                        <th style="text-align: center">标题</th>
                        <th style="text-align: center">操作</th>
                        <th style="text-align: center">备注</th>
                    </tr>
                    </thead>
                    <tbody id="tbody">
                        {% if pd_lst %}
                            {% for pd in pd_lst %}
                                <tr>
                                <td style="text-align: center"><input type='checkbox' name='checkItem' value="{{ pd.product_id }}"></td>
                                <td style="text-align: center">{{ pd.asin }}</td>
                                <td style="text-align: center">{{ pd.market }}</td>
                                <td style='text-align: center; max-width: 200px; overflow:hidden; text-overflow: ellipsis; white-space: nowrap'>{{ pd.goods_name }}</td>
                                <td style="text-align: center"><a href='javascript:;' onclick=query('{{ pd.product_id }}')>查看 </a>
                                    <a href='javascript:;' onclick=get('{{ pd.product_id }}')>  抓取信息 </a>
                                    <a href='javascript:;' onclick=del({{ pd.product_id }})> 删除</a></td>
                                <td></td>
                            </tr>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <th style="text-align: center"><input type="checkbox"></th>
                        <th style="text-align: center">ASIN</th>
                        <th style="text-align: center">市场</th>
                        <th style="text-align: center">标题</th>
                        <th style="text-align: center">操作</th>
                        <th style="text-align: center">备注</th>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>

    </div>
</main>
<!-- end::main content -->

<!-- begin::global scripts -->
<script src="../../static/assets/vendors/bundle.js"></script>
<!-- end::global scripts -->

<!-- begin::dataTable -->
<script src="../../static/assets/vendors/dataTable/jquery.dataTables.min.js"></script>
<script src="../../static/assets/vendors/dataTable/dataTables.bootstrap4.min.js"></script>
<script src="../../static/assets/vendors/dataTable/dataTables.responsive.min.js"></script>
<script src="../../static/assets/js/examples/datatable.js"></script>
<!-- end::dataTable -->

<!-- begin::chart -->
<script src="../../static/assets/vendors/charts/chartjs/chart.min.js"></script>
<!--<script src="../static/assets/js/examples/charts/chartjs.js"></script> -->
<!-- end::chart -->

<!-- begin::select2 -->
<script src="../../static/assets/vendors/select2/js/select2.min.js"></script>
<script src="../../static/assets/js/examples/select2.js"></script>
<!-- end::select2 -->

<!-- begin::daterangepicker -->
<script src="../../static/assets/vendors/datepicker/daterangepicker.js"></script>
<!-- end::daterangepicker -->

<!-- begin::dashboard -->
<script src="../../static/assets/js/examples/dashboard.js"></script>
<!-- end::dashboard -->

<!-- begin::range slider -->
<script src="../../static/assets/vendors/range-slider/js/ion.rangeSlider.min.js"></script>
<script src="../../static/assets/js/examples/range-slider.js"></script>
<!-- end::range slider -->

<!-- begin::input mask -->
<script src="../../static/assets/vendors/input-mask/jquery.mask.js"></script>
<script src="../../static/assets/js/examples/input-mask.js"></script>
<!-- end::input mask -->

<!-- begin::input mask -->
<script src="../../static/assets/vendors/tagsinput/bootstrap-tagsinput.js"></script>
<script src="../../static/assets/js/examples/tagsinput.js"></script>

<!-- begin::custom scripts -->
<script src="../../static/assets/js/custom.js"></script>
<script src="../../static/assets/js/app.js"></script>
<!-- end::custom scripts -->



<script>
    function query(asin) {
        console.log(asin)
        location.href = '/query?asin=' + asin
    }
    function get(asin) {
        location.href = '/trace_pds?asin=' + asin
        alert('正在爬取数据，请稍候......')
    }
    //爬取完成返回状态
    //筛选
    //批量提交

    $("#deleteLimit").click(function (){
        $.ajax({
            type:'post',
            url:'{{url_for("sp_bp.delete_limit")}}',
            success:function (data){
                alert(data)
            }
        })
    })



        function addTable(data) {
            $.each(JSON.parse(data), function (i, item) {
                //进行二次遍历json数据
                $.each(item, function (j, item1) {
                    console.log(item1.asin)
                    //向表格中动态添加数据
                    $("#tbody").append(
                        "<tr>" +
                        "<td>" + "<input type='checkbox' name='checkItem' value='" + item1.id + "'>" + "</td>" +
                        "<td><a href=" + item1.url + " target='_blank'>" + item1.asin + "</a></td>" +
                        "<td>" + item1.market + "</td>" +
                        "<td style='text-align: center; max-width: 200px; overflow:hidden; text-overflow: ellipsis; white-space: nowrap'>" + item1.goods_name + "</td>" +
                        "<td>" + "<a href='javascript:;' onclick=query(" + item1.id + ")>查看 </a>"
                        + "<a href='javascript:;' onclick=get(" + item1.id + ")>  抓取信息 </a>"
                        + "<a href='javascript:;' onclick=del(" + item1.id + ")> 删除</a>"
                        + "</td>" +
                        "<td>" + "</td>" +
                        "</tr>"
                    );
                });
            })
        }


    $(document).ready(function()
    {
        //全选
        $("#checkAll").click(function(){
            $("[name=checkItem]:checkbox").prop("checked",this.checked);
        });

        //复选框组的联动效果
        $("[name=checkItem]:checkbox").click(function(){
            var flag = true;
            $("[name=checkItem]:checkbox").each(function(){
                if(!this.checked)
                {
                    flag = false;
                }
            });
            $("#checkAll").prop("checked",flag);
        });

        //反选
        $("#btnCheckedRev").click(function(){
            $("[name=checkItem]:checkbox").each(function(){
                this.checked = !this.checked;
            });
        });

        //提交
        $("#btnSubmit").click(function(){
            var idArray = new Array(); //用户ID数组
            $("[name=checkItem]:checkbox:checked").each(function(){
                idArray.push($(this).val());
            });
            if(idArray.length==0)
            {
                alert("请选择至少一个产品！");
                return;
            }

            if (!confirm("确定提交记录吗？")) {
                return;
            }

            //执行Ajax请求
            $.ajax({
                type: "POST",
                url: "{{ url_for('sp_bp.trace_pds') }}",
                data:{
                    asins:JSON.stringify(idArray)
                },
                success: function(result) {
                    alert('任务添加完成，请稍后查看抓取结果')
                }
            });
        });
    });

</script>

</body>
</html>